SET NAMES WIN1254;
SET SQL DIALECT 3;
/* Create database : POSTO       */
CREATE DATABASE 'C:\Projeto\POSTO.FDB' USER 'SYSDBA' PASSWORD 'masterkey' PAGE_SIZE 4096  DEFAULT CHARACTER SET WIN1254;

/***********************************/
/*              Tables             */
/***********************************/

/* Table: BOMBA  */
CREATE TABLE BOMBA (
       CODIGO INTEGER NOT NULL,
       DESCRICAO VARCHAR(50),
       TANQUE INTEGER,
      CONSTRAINT PK_BOMBA PRIMARY KEY (CODIGO)
);

CREATE INDEX FK_TANQBOMBA ON BOMBA(TANQUE);

CREATE UNIQUE INDEX PK_BOMBA ON BOMBA(CODIGO);

/* Table: BOMBATANQUE  */
CREATE TABLE BOMBATANQUE (
       BOMBA INTEGER NOT NULL,
       TANQUE INTEGER NOT NULL,
      CONSTRAINT PK_BOMBATANQ PRIMARY KEY (BOMBA,TANQUE)
);

CREATE INDEX FK_BB ON BOMBATANQUE(BOMBA);

CREATE INDEX FK_BT ON BOMBATANQUE(TANQUE);

CREATE UNIQUE INDEX PK_BOMBATANQ ON BOMBATANQUE(BOMBA, TANQUE);

/* Table: COMBUSTIVEL  */
CREATE TABLE COMBUSTIVEL (
       CODIGO INTEGER NOT NULL,
       DESCRICAO VARCHAR(50) NOT NULL,
       VALOR DECIMAL(18,3),
      CONSTRAINT PK_COMB PRIMARY KEY (CODIGO)
);

CREATE UNIQUE INDEX PK_COMB ON COMBUSTIVEL(CODIGO);

/* Table: TANQUE  */
CREATE TABLE TANQUE (
       CODIGO INTEGER NOT NULL,
       DESCRICAO VARCHAR(50),
       COMBUSTIVEL INTEGER,
      CONSTRAINT PK_TANQ PRIMARY KEY (CODIGO)
);

CREATE INDEX FK_COMBTANQ ON TANQUE(COMBUSTIVEL);

CREATE UNIQUE INDEX PK_TANQ ON TANQUE(CODIGO);

/* Table: VENDA  */
CREATE TABLE VENDA (
       CODIGO INTEGER NOT NULL,
       BOMBA INTEGER,
       QTDE DECIMAL(18,3),
       VALOR DECIMAL(18,3),
       VALOR_IMPOSTO DECIMAL(18,3),
       DATA DATE,
      CONSTRAINT PK_VENDA PRIMARY KEY (CODIGO)
);

CREATE INDEX FK_BOMBAVENDA ON VENDA(BOMBA);

CREATE UNIQUE INDEX PK_VENDA ON VENDA(CODIGO);

COMMIT WORK;

/*---------------------------*/
/*  Foreign Key Definitions  */
/*---------------------------*/
ALTER TABLE BOMBATANQUE ADD CONSTRAINT FK_BB FOREIGN KEY (BOMBA) REFERENCES BOMBA(CODIGO);
ALTER TABLE VENDA ADD CONSTRAINT FK_BOMBAVENDA FOREIGN KEY (BOMBA) REFERENCES BOMBA(CODIGO);
ALTER TABLE BOMBATANQUE ADD CONSTRAINT FK_BT FOREIGN KEY (TANQUE) REFERENCES TANQUE(CODIGO);
ALTER TABLE TANQUE ADD CONSTRAINT FK_COMBTANQ FOREIGN KEY (COMBUSTIVEL) REFERENCES COMBUSTIVEL(CODIGO);
ALTER TABLE BOMBA ADD CONSTRAINT FK_TANQBOMBA FOREIGN KEY (TANQUE) REFERENCES TANQUE(CODIGO);

/*  Check Constraints  */
COMMIT WORK;
SET TERM ^ ;
COMMIT WORK^
SET TERM ; ^

/* Grant role for this database */

CREATE ROLE RDB$ADMIN;

/* Grant permissions for this database */
GRANT SELECT ON RDB$FORMATS TO PUBLIC;
GRANT SELECT ON RDB$PAGES TO PUBLIC;
GRANT SELECT ON RDB$ROLES TO PUBLIC;

COMMIT WORK;